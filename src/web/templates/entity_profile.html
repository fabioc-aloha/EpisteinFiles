{% extends "base.html" %}
{% block title %}{{ entity.canonical }} â€” Epstein Files Analyzer{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Breadcrumb -->
    <div class="text-sm text-gray-500">
        <a href="/entities" class="hover:text-amber-400">Entities</a>
        <span class="mx-2">/</span>
        <span class="text-gray-300">{{ entity.canonical }}</span>
    </div>

    <!-- Entity header -->
    <div class="bg-gray-900 rounded-xl p-6 border border-gray-800">
        <div class="flex justify-between items-start">
            <div>
                <h2 class="text-2xl font-bold">{{ entity.canonical }}</h2>
                <div class="flex gap-3 mt-2">
                    <span class="px-2 py-0.5 rounded text-xs
                        {% if entity.entity_type == 'PERSON' %}bg-blue-900/50 text-blue-300
                        {% elif entity.entity_type == 'ORG' %}bg-purple-900/50 text-purple-300
                        {% elif entity.entity_type == 'GPE' %}bg-green-900/50 text-green-300
                        {% else %}bg-gray-800 text-gray-400{% endif %}">
                        {{ entity.entity_type }}
                    </span>
                    <span class="text-sm text-gray-400">{{ "{:,}".format(entity.mention_count) }} mentions</span>
                </div>
                {% if entity.aliases %}
                <div class="mt-3 text-sm text-gray-500">
                    Also known as: {{ entity.aliases|join(", ") }}
                </div>
                {% endif %}
            </div>
            <a href="/graph?entity_id={{ entity.id }}"
                class="text-sm bg-gray-800 hover:bg-gray-700 px-3 py-1.5 rounded-lg transition">
                View in Graph &#8599;
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Connections -->
        <div class="bg-gray-900 rounded-xl p-6 border border-gray-800">
            <h3 class="text-lg font-semibold mb-4">Connections ({{ connections|length }})</h3>
            {% if connections %}
            <div class="space-y-2 max-h-96 overflow-y-auto">
                {% for conn in connections %}
                {% set other_id = conn.entity_b_id if conn.entity_a_id == entity.id else conn.entity_a_id %}
                {% set other = connected_entities.get(other_id) %}
                {% if other %}
                <a href="/entities/{{ other.id }}"
                    class="flex justify-between items-center px-3 py-2 rounded hover:bg-gray-800 transition">
                    <span class="text-sm text-gray-300">{{ other.canonical }}</span>
                    <span class="text-xs text-gray-600">{{ conn.evidence_count }} docs</span>
                </a>
                {% endif %}
                {% endfor %}
            </div>
            {% else %}
            <p class="text-gray-500 italic text-sm">No connections mapped yet.</p>
            {% endif %}
        </div>

        <!-- Document mentions -->
        <div class="lg:col-span-2 bg-gray-900 rounded-xl p-6 border border-gray-800">
            <h3 class="text-lg font-semibold mb-4">Document Mentions</h3>
            {% if mentions %}
            <div class="space-y-3">
                {% for m in mentions %}
                <a href="/docs/{{ m.document.id }}"
                    class="block p-3 rounded-lg hover:bg-gray-800 transition border border-gray-800/50">
                    <div class="text-sm text-amber-400">{{ m.document.filename }}</div>
                    {% if m.context %}
                    <p class="text-xs text-gray-500 mt-1 line-clamp-2">...{{ m.context }}...</p>
                    {% endif %}
                    <div class="flex gap-3 mt-1 text-xs text-gray-600">
                        <span class="uppercase">{{ m.document.source }}</span>
                        {% if m.page_number %}<span>Page {{ m.page_number }}</span>{% endif %}
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-gray-500 italic text-sm">No document mentions found.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
